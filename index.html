<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½›å­¦ç ”ä¹ ç¤¾ - æ™ºæ…§è¯åº“</title>
    <style>
        :root { --bg: #f5f2ed; --sidebar-bg: #ffffff; --accent: #967d5a; --text: #2c2e2f; --border: #dcd7cc; }
        body, html { height: 100%; margin: 0; font-family: "PingFang SC", serif; background: var(--bg); color: var(--text); overflow: hidden; }
        .app-wrapper { display: flex; height: 100vh; }

        /* å·¦ä¾§åˆ—è¡¨ */
        .sidebar { width: 380px; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--sidebar-bg); flex-shrink: 0; }
        .sidebar-header { padding: 25px; background: var(--accent); color: white; }
        .term-list { flex: 1; overflow-y: auto; }
        .term-item { border-bottom: 1px solid #f0eee9; }
        .term-header { padding: 18px 25px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .term-header h3 { margin: 0; font-size: 0.95rem; }
        .term-content { display: none; padding: 0 25px 20px; background: #fbfaf8; font-size: 0.9rem; line-height: 1.7; }
        .term-item.active .term-content { display: block; }
        .label { font-weight: bold; color: var(--accent); display: block; margin-top: 10px; font-size: 0.8rem; }

        /* å³ä¾§å¯¹è¯ */
        .chat-container { flex: 1; display: flex; flex-direction: column; background: #eeebdf; min-width: 0; }
        #chat-window { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 85%; padding: 12px 16px; border-radius: 12px; position: relative; line-height: 1.6; word-wrap: break-word; }
        .user-msg { align-self: flex-end; background: var(--accent); color: white; }
        .gemini-msg { align-self: flex-start; background: white; border: 1px solid var(--border); white-space: pre-wrap; padding-bottom: 40px; }
        
        .entry-trigger { position: absolute; bottom: 8px; right: 12px; background: var(--accent); color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; }

        .input-area { padding: 20px; background: white; border-top: 1px solid var(--border); display: flex; gap: 10px; }
        textarea { flex: 1; height: 60px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; resize: none; font-family: inherit; }
        .send-btn { padding: 0 20px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* å¼¹çª— */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; justify-content: center; align-items: center; }
        .modal { background: white; padding: 25px; border-radius: 12px; width: 450px; max-width: 90%; }
        .modal input, .modal textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 style="margin:0; font-size:1.1rem; letter-spacing:1px;">ä½›å­¦ç§è—è¯åº“</h2>
            <div id="count" style="font-size:12px; opacity:0.8; margin-top:5px"></div>
        </div>
        <div class="term-list" id="termList"></div>
    </div>

    <div class="chat-container">
        <div id="chat-window">
            <div class="message gemini-msg">å·²è¿æ¥è‡³éƒ¨ç½²ç¯å¢ƒã€‚è¯·è¾“å…¥è¯æ¡ï¼Œæˆ‘ä¼šè‡ªåŠ¨ä¸ºæ‚¨ç”Ÿæˆç»“æ„åŒ–å†…å®¹ã€‚</div>
        </div>
        <div class="input-area">
            <textarea id="userInput" placeholder="è¾“å…¥ä½ æƒ³ç ”ä¹ çš„æ¦‚å¿µ..."></textarea>
            <button class="send-btn" onclick="askGemini()">æé—®</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="entryModal">
    <div class="modal">
        <h3 style="margin:0; color:var(--accent)">â• æ‰‹åŠ¨å½•å…¥è¯æ¡</h3>
        <input type="text" id="in-t" placeholder="åç§° (å¦‚: 51. ç¼˜èµ·)">
        <textarea id="in-q" placeholder="ã€çŸ­å¼•ã€‘"></textarea>
        <textarea id="in-e" placeholder="ã€è§£é‡Šã€‘" style="height:80px"></textarea>
        <textarea id="in-m" placeholder="ã€å¸¸è§è¯¯è§£ã€‘"></textarea>
        <textarea id="in-p" placeholder="ã€ä¿®æŒæç¤ºã€‘"></textarea>
        <div class="modal-btns">
            <button onclick="closeModal()">å–æ¶ˆ</button>
            <button style="background:var(--accent); color:white; border:none; padding:8px 20px; border-radius:4px; cursor:pointer;" onclick="saveEntry()">ç¡®è®¤æ·»åŠ </button>
        </div>
    </div>
</div>

<script>
    // é¢„è®¾ 10 æ¡ç¤ºä¾‹ï¼Œç¡®ä¿åœ¨éƒ¨ç½²æ—¶ç”±äºæ•°æ®è¿‡å¤§å¯èƒ½äº§ç”Ÿçš„é”™è¯¯æœ€å°åŒ–
    let myTerms = [
        {t:"1. ä¸­é˜´", q:"â€œè¯¸è¡Œæ— å¸¸ã€‚â€", e:"ç”Ÿå‘½çŠ¶æ€è½¬æ¢çš„ç¼éš™ï¼Œå¦‚ç”Ÿæ­»ä¹‹é—´ã€‚", m:"å½“åšææ€–ä¼ è¯´ã€‚", p:"ç»ƒä¹ åœ¨æƒ…ç»ªçªå‘æ—¶ä¿æŒè§‰çŸ¥ã€‚"},
        {t:"2. äº”è•´", q:"â€œç…§è§äº”è•´çš†ç©ºã€‚â€", e:"è‰²å—æƒ³è¡Œè¯†äº”ç§èº«å¿ƒèšåˆã€‚", m:"ä»¥ä¸ºæœ‰ä¸ªæ°¸æ’çš„â€˜è¯†â€™ã€‚", p:"è§‚å¯Ÿæƒ…ç»ªå¦‚ä½•ç”±â€˜å—â€™è½¬ä¸ºâ€˜æƒ³â€™ã€‚"},
        {t:"3. å…­æ ¹", q:"â€œæ‘„æŠ¤è¯¸æ ¹ã€‚â€", e:"çœ¼è€³é¼»èˆŒèº«æ„å…­ç§æ„Ÿå®˜åŠŸèƒ½ã€‚", m:"è¦æŠŠæ„Ÿå®˜å¼ºè¡Œå…³æ‰ã€‚", p:"ç»ƒâ€˜çœ‹è§åªæ˜¯çœ‹è§â€™ã€‚"},
        {t:"4. å…­å°˜", q:"â€œåº”æ— æ‰€ä½ã€‚â€", e:"è‰²å£°é¦™å‘³è§¦æ³•å…­ç§å¤–åœ¨å¯¹è±¡ã€‚", m:"ä»¥ä¸ºå¤–å¢ƒæ˜¯è‚®è„çš„ã€‚", p:"åœ¨è¯±æƒ‘é¢å‰è§‚å¯Ÿå¿ƒçš„èµ·ä¼ã€‚"},
        {t:"5. å…­è¯†", q:"â€œä¸€åˆ‡å”¯å¿ƒé€ ã€‚â€", e:"æ ¹å°˜æ¥è§¦åäº§ç”Ÿçš„äº†åˆ«åŠŸèƒ½ã€‚", m:"æŠŠè¯†å½“æˆçœŸæˆ‘ã€‚", p:"å†²çªæ—¶è§‰å¯Ÿæ„è¯†çš„åè§ã€‚"},
        {t:"6. ä¸‰å®", q:"â€œå½’ä¾ä½›æ³•åƒ§ã€‚â€", e:"ä½›ã€æ³•ã€åƒ§ï¼Œè§‰æ‚Ÿçš„å¯¼å¸ˆã€è·¯å¾„ä¸ä¼™ä¼´ã€‚", m:"å½“æˆå¤–åœ¨ç¥çµã€‚", p:"æ¯æ—¥è‡ªçœæ˜¯å¦èƒŒç¦»è§‰é†’ã€‚"},
        {t:"7. çšˆä¾", q:"â€œè‡ªå‡€å…¶æ„ã€‚â€", e:"ç¡®ç«‹äººç”Ÿä»¥è§‰é†’ä¸ºå”¯ä¸€çš„æ–¹å‘ã€‚", m:"å½“æˆå…¥æ•™ä»ªå¼ã€‚", p:"é‡åˆ°çƒ¦èºå…ˆå›æƒ³çšˆä¾çš„åˆå¿ƒã€‚"},
        {t:"8. ç©ºæ€§", q:"â€œè‰²å³æ˜¯ç©ºã€‚â€", e:"ä¸‡æ³•ä¾ç¼˜è€Œç”Ÿï¼Œæ²¡æœ‰å›ºå®šæ°¸æ’çš„æœ¬æ€§ã€‚", m:"ç©ºå°±æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚", p:"æ‰§ç€æ—¶é—®ï¼šå®ƒä¾èµ–ä»€ä¹ˆå­˜åœ¨ï¼Ÿ"},
        {t:"9. ç¼˜èµ·", q:"â€œæ­¤æœ‰æ•…å½¼æœ‰ã€‚â€", e:"ä¸€åˆ‡äº‹ç‰©éƒ½æ˜¯æ¡ä»¶çš„ç»„åˆã€‚", m:"å®¿å‘½è®ºæˆ–å¶ç„¶è®ºã€‚", p:"ä»ç¡çœ ã€é¥®é£Ÿè§‚å¯Ÿèº«ä½“çš„ç¼˜èµ·ã€‚"},
        {t:"10. æ— å¸¸", q:"â€œè¯¸è¡Œæ— å¸¸ã€‚â€", e:"äº‹ç‰©æ—¶åˆ»åœ¨å˜è¿ã€‚ç²—ä¸ºç”Ÿç­ï¼Œç»†ä¸ºåˆ¹é‚£ã€‚", m:"æ„Ÿåˆ°æ¶ˆæåŒä¸–ã€‚", p:"çæƒœå½“ä¸‹çš„æ¯ä¸€ä¸ªå› ç¼˜ã€‚"}
    ];

    const API_KEY = "AIzaSyB5FyPB_XW5-2f98p12WFqI1je5H5WmDyg";

    function renderList() {
        const list = document.getElementById('termList');
        if(!list) return;
        list.innerHTML = '';
        myTerms.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'term-item';
            div.innerHTML = `
                <div class="term-header" onclick="toggleItem(this)">
                    <h3>${item.t}</h3><span>â–¼</span>
                </div>
                <div class="term-content">
                    <span class="label">ã€çŸ­å¼•ã€‘</span><div>${item.q || '-'}</div>
                    <span class="label">ã€è§£é‡Šã€‘</span><div>${item.e || '-'}</div>
                    <span class="label">ã€å¸¸è§è¯¯è§£ã€‘</span><div>${item.m || '-'}</div>
                    <span class="label">ã€ä¿®æŒæç¤ºã€‘</span><div>${item.p || '-'}</div>
                </div>`;
            list.appendChild(div);
        });
        document.getElementById('count').innerText = `å·²åŠ è½½ ${myTerms.length} ä¸ªæ¡ç›®`;
    }

    function toggleItem(el) {
        const parent = el.parentElement;
        parent.classList.toggle('active');
    }

    async function askGemini() {
        const input = document.getElementById('userInput');
        const q = input.value.trim();
        if (!q) return;

        appendMsg('user', q);
        input.value = 'æ­£åœ¨æ€è€ƒä¸­...';
        input.disabled = true;

        // è‡ªåŠ¨æ·»åŠ  Prompt æŒ‡ä»¤
        const promptText = `è¯·è§£é‡Šä½›å­¦æ¦‚å¿µâ€œ${q}â€ã€‚è¦æ±‚å›å¤å¿…é¡»åŒ…å«ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†ç”¨æ¢è¡Œéš”å¼€ï¼š
1.çŸ­å¼•ï¼š(ä¸€å¥ç»å…¸é‡‘å¥)
2.è§£é‡Šï¼š(ç²¾ç‚¼æ ¸å¿ƒä¹‰ç†)
3.å¸¸è§è¯¯è§£ï¼š(é¿å‘æŒ‡å—)
4.ä¿®æŒæç¤ºï¼š(å®æ“å»ºè®®)`;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] })
            });

            const data = await response.json();
            const reply = data.candidates[0].content.parts[0].text;
            appendMsg('gemini', reply);
        } catch (e) {
            appendMsg('gemini', "GitHub ç¯å¢ƒè¿æ¥ API è¶…æ—¶ã€‚å»ºè®®æ£€æŸ¥ API Key æˆ–ç¨åé‡è¯•ã€‚æ‚¨å¯ä»¥å…ˆç‚¹å‡»å³ä¾§æŒ‰é’®æ‰‹åŠ¨å½•å…¥ã€‚");
        } finally {
            input.value = '';
            input.disabled = false;
        }
    }

    function appendMsg(role, text) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = `message ${role}-msg`;
        div.innerText = text;

        if (role === 'gemini') {
            const btn = document.createElement('button');
            btn.className = 'entry-trigger';
            btn.innerHTML = 'ğŸ“¥ æ‰‹åŠ¨å½•å…¥';
            btn.onclick = () => openModal();
            div.appendChild(btn);
        }
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    function openModal() { document.getElementById('entryModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('entryModal').style.display = 'none'; }

    function saveEntry() {
        const t = document.getElementById('in-t').value;
        if (!t) return alert("è¯·è¾“å…¥åç§°");
        myTerms.unshift({
            t: t,
            q: document.getElementById('in-q').value,
            e: document.getElementById('in-e').value,
            m: document.getElementById('in-m').value,
            p: document.getElementById('in-p').value
        });
        renderList();
        closeModal();
        ['in-t','in-q','in-e','in-m','in-p'].forEach(id => document.getElementById(id).value = '');
    }

    // ç¡®ä¿ DOM åŠ è½½åå†è¿è¡Œ
    window.onload = renderList;
</script>
</body>
</html>
