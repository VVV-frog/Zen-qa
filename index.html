<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä½›å­¦ç ”ä¹ ç¤¾ - æ™ºæ…§è¯åº“(æ•…éšœä¿®å¤ç‰ˆ)</title>
    <style>
        :root { --bg: #f5f2ed; --sidebar-bg: #ffffff; --accent: #967d5a; --text: #2c2e2f; --border: #dcd7cc; }
        body, html { height: 100%; margin: 0; font-family: "PingFang SC", serif; background: var(--bg); color: var(--text); overflow: hidden; }
        .app-wrapper { display: flex; height: 100vh; }

        /* å·¦ä¾§åˆ—è¡¨ */
        .sidebar { width: 380px; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--sidebar-bg); }
        .sidebar-header { padding: 25px; background: var(--accent); color: white; }
        .term-list { flex: 1; overflow-y: auto; padding-bottom: 20px; }
        .term-item { border-bottom: 1px solid #f0eee9; }
        .term-header { padding: 18px 25px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .term-header h3 { margin: 0; font-size: 1rem; font-weight: 500; }
        .term-content { display: none; padding: 0 25px 20px; background: #fbfaf8; line-height: 1.8; font-size: 0.95rem; }
        .term-item.active .term-content { display: block; }
        .label { font-weight: bold; color: var(--accent); display: block; margin-top: 10px; font-size: 0.85rem; border-bottom: 1px solid #eee; }

        /* å³ä¾§å¯¹è¯åŒº */
        .chat-container { flex: 1; display: flex; flex-direction: column; background: #eeebdf; }
        #chat-window { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; }
        .message { max-width: 85%; padding: 15px 20px; border-radius: 12px; position: relative; line-height: 1.6; }
        .user-msg { align-self: flex-end; background: var(--accent); color: white; }
        .gemini-msg { align-self: flex-start; background: white; border: 1px solid var(--border); white-space: pre-wrap; padding-bottom: 45px; }

        /* å½•å…¥æŒ‰é’® */
        .manual-entry-btn { position: absolute; bottom: 10px; right: 15px; background: var(--accent); color: white; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }

        .input-area { padding: 20px; background: white; border-top: 1px solid var(--border); display: flex; gap: 12px; }
        textarea#userInput { flex: 1; height: 65px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; resize: none; font-family: inherit; }
        .send-btn { width: 80px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* å¼¹çª—ç³»ç»Ÿ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; justify-content: center; align-items: center; }
        .modal { background: white; padding: 25px; border-radius: 12px; width: 450px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal input, .modal textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .btn-cancel { background: #eee; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; }
        .btn-confirm { background: var(--accent); color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 style="margin:0; font-size:1.2rem; letter-spacing:2px;">ä½›å­¦ç§è—è¯åº“</h2>
            <div id="count" style="font-size:12px; margin-top:5px; opacity:0.8;"></div>
        </div>
        <div class="term-list" id="termList"></div>
    </div>

    <div class="chat-container">
        <div id="chat-window">
            <div class="message gemini-msg">è¯·è¾“å…¥ä½›å­¦æ¦‚å¿µè¿›è¡Œç ”ä¹ ã€‚è‹¥å› ç½‘ç»œé—®é¢˜å¯¼è‡´å›ç­”å¤±è´¥ï¼Œæ‚¨ä»å¯ç‚¹å‡»æ­¤å¤„çš„æŒ‰é’®æ‰‹åŠ¨å½•å…¥æ–°è¯æ¡ã€‚
                <button class="manual-entry-btn" onclick="openModal()">ğŸ“¥ æ‰‹åŠ¨å½•å…¥</button>
            </div>
        </div>
        <div class="input-area">
            <textarea id="userInput" placeholder="ä¾‹å¦‚ï¼šä»€ä¹ˆæ˜¯å› æœï¼Ÿ"></textarea>
            <button class="send-btn" onclick="askGemini()">æé—®</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="entryModal">
    <div class="modal">
        <h3 style="margin-top:0; color:var(--accent)">æ–°å¢è¯æ¡</h3>
        <input type="text" id="in-t" placeholder="åç§° (å¦‚: 51. å› æœ)">
        <textarea id="in-q" placeholder="çŸ­å¼• (é‡‘å¥)"></textarea>
        <textarea id="in-e" placeholder="è¯¦ç»†è§£é‡Š" style="height:80px"></textarea>
        <textarea id="in-m" placeholder="å¸¸è§è¯¯è§£"></textarea>
        <textarea id="in-p" placeholder="ä¿®æŒæç¤º"></textarea>
        <div class="modal-btns">
            <button class="btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn-confirm" onclick="saveEntry()">ä¿å­˜è¯æ¡</button>
        </div>
    </div>
</div>

<script>
    // ä¹‹å‰é‚£ 50 æ¡æ•°æ®çš„ç²¾ç®€ç‰ˆï¼Œç¡®ä¿è¯­æ³•ä¸æŠ¥é”™
    let myTerms = [
        {t:"1) ä¸­é˜´", q:"â€œè¯¸è¡Œæ— å¸¸ã€‚â€", e:"ç”Ÿæ­»è¿‡æ¸¡é˜¶æ®µã€‚", m:"çº¯ç²¹ææ€–æ•…äº‹ã€‚", p:"ç»ƒè½¬æŠ˜å¤„é†’æ¥ã€‚"},
        {t:"2) äº”è•´", q:"â€œç…§è§äº”è•´çš†ç©ºã€‚â€", e:"è‰²å—æƒ³è¡Œè¯†ã€‚", m:"æŠŠè¯†å½“æ°¸æ’çµé­‚ã€‚", p:"å®šä½å—ä¸æƒ³ã€‚"},
        {t:"3) å…­æ ¹", q:"â€œæ‘„æŠ¤è¯¸æ ¹ã€‚â€", e:"çœ¼è€³é¼»èˆŒèº«æ„ã€‚", m:"å¼ºè¡Œå…³é—­æ„Ÿå®˜ã€‚", p:"çœ‹è§åªæ˜¯çœ‹è§ã€‚"}
        /* æ‚¨å¯ä»¥ä¹‹åç»§ç»­è¡¥å……å…¶ä½™è¯æ¡ */
    ];

    const API_KEY = "AIzaSyB5FyPB_XW5-2f98p12WFqI1je5H5WmDyg";

    function renderList() {
        const list = document.getElementById('termList');
        list.innerHTML = '';
        myTerms.forEach((item, index) => {
            const wrap = document.createElement('div');
            wrap.className = 'term-item';
            wrap.innerHTML = `
                <div class="term-header" onclick="this.parentElement.classList.toggle('active')">
                    <h3>${item.t}</h3><span>â–¼</span>
                </div>
                <div class="term-content">
                    <span class="label">ã€çŸ­å¼•ã€‘</span><div>${item.q || 'æ— '}</div>
                    <span class="label">ã€è§£é‡Šã€‘</span><div>${item.e || 'æ— '}</div>
                    <span class="label">ã€ä¿®æŒã€‘</span><div>${item.p || 'æ— '}</div>
                </div>`;
            list.appendChild(wrap);
        });
        document.getElementById('count').innerText = `å·²å­˜å…¥ ${myTerms.length} ä¸ªè¯æ¡`;
    }

    async function askGemini() {
        const input = document.getElementById('userInput');
        const q = input.value.trim();
        if (!q) return;

        appendMsg('user', q);
        input.value = '';

        // æ ¸å¿ƒä¿®å¤ï¼šæ›´æ–°åçš„ API URL
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `è¯·ç®€æ´è§£é‡Šä½›å­¦åè¯â€œ${q}â€ï¼Œåˆ†å››æ®µï¼šçŸ­å¼•ã€è§£é‡Šã€å¸¸è§è¯¯è§£ã€ä¿®æŒæç¤ºã€‚` }] }]
                })
            });

            if (!response.ok) throw new Error('API Error');
            
            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            appendMsg('gemini', text);
        } catch (e) {
            console.error(e);
            appendMsg('gemini', "ã€ç³»ç»Ÿæ¶ˆæ¯ã€‘ç½‘ç»œè¿æ¥è¶…æ—¶ã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„ç†è§£æ‰‹åŠ¨å½•å…¥è¯¥è¯æ¡ã€‚");
        }
    }

    function appendMsg(role, text) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = `message ${role}-msg`;
        div.innerText = text;

        if (role === 'gemini') {
            const btn = document.createElement('button');
            btn.className = 'manual-entry-btn';
            btn.innerHTML = 'ğŸ“¥ å½•å…¥';
            btn.onclick = openModal;
            div.appendChild(btn);
        }

        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    function openModal() { document.getElementById('entryModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('entryModal').style.display = 'none'; }

    function saveEntry() {
        const t = document.getElementById('in-t').value;
        if (!t) return alert("è¯·è¾“å…¥è¯æ¡åç§°");
        
        myTerms.unshift({
            t: t,
            q: document.getElementById('in-q').value,
            e: document.getElementById('in-e').value,
            m: document.getElementById('in-m').value,
            p: document.getElementById('in-p').value
        });

        renderList();
        closeModal();
        // æ¸…ç©ºè¾“å…¥æ¡†
        ['in-t','in-q','in-e','in-m','in-p'].forEach(id => document.getElementById(id).value = '');
    }

    renderList();
</script>
</body>
</html>
