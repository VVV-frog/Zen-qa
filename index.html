<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>佛学私藏词库 - 终极修复版</title>
    <style>
        :root { --bg: #f5f2ed; --sidebar-bg: #ffffff; --accent: #967d5a; --text: #2c2e2f; --border: #dcd7cc; }
        body, html { height: 100%; margin: 0; font-family: "PingFang SC", serif; background: var(--bg); color: var(--text); overflow: hidden; }
        .app-wrapper { display: flex; height: 100vh; }
        .sidebar { width: 380px; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--sidebar-bg); flex-shrink: 0; }
        .sidebar-header { padding: 25px; background: var(--accent); color: white; }
        .term-list { flex: 1; overflow-y: auto; }
        .term-item { border-bottom: 1px solid #f0eee9; }
        .term-header { padding: 18px 25px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .term-header h3 { margin: 0; font-size: 0.95rem; }
        .term-content { display: none; padding: 0 25px 20px; background: #fbfaf8; font-size: 0.9rem; line-height: 1.7; }
        .term-item.active .term-content { display: block; }
        .label { font-weight: bold; color: var(--accent); display: block; margin-top: 10px; font-size: 0.8rem; }
        .chat-container { flex: 1; display: flex; flex-direction: column; background: #eeebdf; min-width: 0; }
        #chat-window { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 85%; padding: 12px 16px; border-radius: 12px; position: relative; line-height: 1.6; word-wrap: break-word; }
        .user-msg { align-self: flex-end; background: var(--accent); color: white; }
        .gemini-msg { align-self: flex-start; background: white; border: 1px solid var(--border); white-space: pre-wrap; }
        .input-area { padding: 20px; background: white; border-top: 1px solid var(--border); display: flex; gap: 10px; }
        textarea { flex: 1; height: 60px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; resize: none; }
        .send-btn { padding: 0 25px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <div class="sidebar">
        <div class="sidebar-header"><h2 style="margin:0;">佛学私藏词库</h2><div id="count" style="font-size:12px; opacity:0.8; margin-top:5px"></div></div>
        <div class="term-list" id="termList"></div>
    </div>
    <div class="chat-container">
        <div id="chat-window"><div class="message gemini-msg">路径已修复。请提问测试 API。</div></div>
        <div class="input-area">
            <textarea id="userInput" placeholder="输入你想研习的概念..."></textarea>
            <button class="send-btn" onclick="askGemini()">提望</button>
        </div>
    </div>
</div>

<script>
    // 基础数据（确保左侧不留白）
    let myTerms = [
        {t:"1. 中阴", q:"“诸行无常。”", e:"生命状态转换的缝隙，如生死之间。", m:"当做恐怖传说。", p:"练习在情绪突发时保持觉知。"},
        {t:"2. 五蕴", q:"“照见五蕴皆空。”", e:"色受想行识五种身心聚合。", m:"以为有个永恒的‘识’。", p:"观察情绪如何由‘受’转为‘想’。"},
        {t:"3. 六根", q:"“摄护诸根。”", e:"眼耳鼻舌身意六种感官功能。", m:"要把感官强行关掉。", p:"练‘看见只是看见’。"},
        {t:"4. 六尘", q:"“应无所住。”", e:"色声香味触法六种外在对象。", m:"以为外境是肮脏的。", p:"在诱惑面前观察心的起伏。"},
        {t:"5. 六识", q:"“一切唯心造。”", e:"根尘接触后产生的了别功能。", m:"把识当成真我。", p:"冲突时觉察意识的偏见。"},
        {t:"6. 三宝", q:"“归依佛法僧。”", e:"佛、法、僧，导师、路径与伙伴。", m:"当成外在神灵。", p:"每日自省是否背离觉醒。"},
        {t:"7. 皈依", q:"“自净其意。”", e:"确立人生以觉醒为唯一的方向。", m:"当成入教仪式。", p:"遇到烦躁先回想初心。"},
        {t:"8. 空性", q:"“色即是空。”", e:"万法依缘而生，没有固定本性。", m:"空就是什么都没有。", p:"执着时问：它依赖什么存在？"},
        {t:"9. 缘起", q:"“此有故彼有。”", e:"一切事物都是条件的组合。", m:"宿命论或偶然论。", p:"观察身体与环境的缘起。"},
        {t:"10. 无常", q:"“诸行无常。”", e:"事物时刻在变迁。粗为生灭，细为刹那。", m:"感到消极厌世。", p:"珍惜当下的每一个因缘。"},
        {t:"11. 无我", q:"“诸法无我。”", e:"没有一个永恒不变的主宰。", m:"否定责任与因果。", p:"分解‘我慢’。"},
        {t:"12. 苦谛", q:"“诸行皆苦。”", e:"不圆满、不安稳的本质。", m:"佛教是苦难的宗教。", p:"观察‘乐’背后的不安稳。"},
        {t:"13. 四圣谛", q:"“知苦断集。”", e:"苦、集、灭、道，解脱的阶段。", m:"只是哲学理论。", p:"遇事按四谛逻辑分析。"},
        {t:"14. 八正道", e:"正见、正思惟、正语、正业等。", m:"道德教条。", p:"今日练习：不说刻薄话。"},
        {t:"15. 三学", e:"戒、定、慧，修行的总纲。", m:"割裂修行。", p:"生活降噪（戒），心念安住（定）。"},
        {t:"16. 戒律", e:"防非止恶的规范。", m:"束缚自由。", p:"守口业，不评是非。"},
        {t:"17. 禅定", e:"心的专注与宁静状态。", m:"发呆或神通。", p:"每日10分钟数息。"},
        {t:"18. 智慧", e:"照见真相的能力。", m:"聪明才智。", p:"在烦恼中寻找空性。"},
        {t:"19. 止", e:"止息散乱，专注所缘。", m:"压抑念头。", p:"呼吸散乱时轻柔带回。"},
        {t:"20. 观", e:"如实观察生灭过程。", m:"胡思乱想。", p:"观察身体触感的生灭。"},
        {t:"21. 四念处", e:"观身、受、心、法。", m:"放空大脑。", p:"走路时只感知脚底。"},
        {t:"22. 正念", e:"不忘失当下，明了觉知。", m:"等于放松。", p:"吃饭时放下手机。"},
        {t:"23. 三法印", e:"无常、无我、涅槃寂静。", m:"口头禅。", p:"用‘这会变吗’检验一切。"},
        {t:"24. 二谛", e:"世俗谛与胜义谛。", m:"互相矛盾。", p:"负责任做事，不执着看果。"},
        {t:"25. 中道", e:"离两边，不堕常断。", m:"折中主义。", p:"既不贪求，也不强压。"},
        {t:"26. 十二因缘", e:"生命流转的环节。", m:"过去世传说。", p:"观察‘触’如何演变成‘爱’。"},
        {t:"27. 业力", e:"身口意的造作及其惯性。", m:"上天惩罚。", p:"修改一个小习惯。"},
        {t:"28. 轮回", e:"惯性模式的死循环。", m:"只有死后才有。", p:"观察每天重复的负面念头。"},
        {t:"29. 出离心", e:"不再寻找虚假安稳的决心。", m:"逃离社会。", p:"看到名利背后的行苦。"},
        {t:"30. 涅槃", e:"熄灭烦恼的清凉境界。", m:"指代死亡。", p:"嗔心停息的瞬间。"},
        {t:"31. 烦恼", e:"染污心性的因素。", m:"敌人。", p:"看着它，不跟随。"},
        {t:"32. 贪", e:"对可爱境的病态抓取。", m:"正当需求。", p:"买东西前等三分钟。"},
        {t:"33. 嗔", e:"对不可爱境的敌视。", m:"自以为正义。", p:"火起时深呼吸。"},
        {t:"34. 痴", e:"不明因果、不明真相。", m:"智商低。", p:"观因缘，破理所当然。"},
        {t:"35. 慢", e:"比较中的自我膨胀。", m:"只有傲慢。", p:"随喜他人成功。"},
        {t:"36. 疑", e:"对正法的犹豫。", m:"不能提问。", p:"带着疑问去实践。"},
        {t:"37. 信", e:"对觉悟可能性的确信。", m:"盲从。", p:"从修行反馈中建信。"},
        {t:"38. 精进", e:"向上向善的持久动力。", m:"用力过猛。", p:"细水长流的每日功课。"},
        {t:"39. 忍辱", e:"在逆境中不生嗔心。", m:"胆小怕事。", p:"面对批评不急辩解。"},
        {t:"40. 布施", e:"舍弃抓取，利他。", m:"买功德。", p:"给他人一个微笑。"},
        {t:"41. 持戒", e:"清净生活的基石。", m:"外在枷锁。", p:"保护他人安全感。"},
        {t:"42. 禅定", e:"心的一境性。", m:"追求境界。", p:"在散乱中认出散乱。"},
        {t:"43. 般若", e:"彻底的觉醒智慧。", m:"哲学知识。", p:"看透‘我’的虚幻。"},
        {t:"44. 菩提心", e:"为利有情愿成佛。", m:"口号。", p:"扩宽心量。"},
        {t:"45. 慈", e:"愿众生得乐。", m:"溺爱。", p:"祝愿讨厌的人平静。"},
        {t:"46. 悲", e:"愿众生离苦。", m:"同情心。", p:"力所能及帮助弱小。"},
        {t:"47. 喜", e:"见他人好生欢喜。", m:"客套。", p:"真心夸奖竞争者。"},
        {t:"48. 舍", e:"平等心，无分别。", m:"冷漠。", p:"不分亲疏施予善意。"},
        {t:"49. 回向", e:"扩大功德的心量。", m:"转账。", p:"功成不居。"},
        {t:"50. 忏悔", e:"清净过往的染污。", m:"沉溺自责。", p:"承认错误，立誓不二过。"}
    ];

    const API_KEY = "AIzaSyB5FyPB_XW5-2f98p12WFqI1je5H5WmDyg";

    function renderList() {
        const list = document.getElementById('termList');
        list.innerHTML = '';
        myTerms.forEach(item => {
            const div = document.createElement('div');
            div.className = 'term-item';
            div.innerHTML = `<div class="term-header" onclick="this.parentElement.classList.toggle('active')"><h3>${item.t}</h3><span>▼</span></div><div class="term-content"><span class="label">【解释】</span><div>${item.e}</div></div>`;
            list.appendChild(div);
        });
        document.getElementById('count').innerText = `已载入 ${myTerms.length} 条`;
    }

    async function askGemini() {
        const input = document.getElementById('userInput');
        const q = input.value.trim();
        if (!q) return;

        appendMsg('user', q);
        input.value = '思考中...';

        // 【核心修正处】使用正式版 v1 路径，降低 404 概率
        const apiUrl = `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${API_KEY}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `请简洁解释佛学词汇“${q}”` }] }]
                })
            });

            if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
            
            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            appendMsg('gemini', text);
        } catch (e) {
            console.error(e);
            appendMsg('gemini', `连接失败 (${e.message})。请检查 API Key 权限。`);
        } finally {
            input.value = '';
        }
    }

    function appendMsg(role, text) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = `message ${role}-msg`;
        div.innerText = text;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    renderList();
</script>
</body>
</html>
